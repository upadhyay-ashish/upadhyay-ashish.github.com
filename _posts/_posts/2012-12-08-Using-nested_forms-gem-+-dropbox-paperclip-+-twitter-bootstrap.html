---           
layout: post
title: Using nested_forms gem + dropbox-paperclip + twitter-bootstrap
date: 2012-12-08 08:25:52 UTC
updated: 2012-12-08 08:25:52 UTC
comments: false
categories: photo-upload multi-model-forms dropbox-rails rails-nested-forms bootstrap rails-paperclip paperclip-dropbox paperclip file-storage-rails accepts_nested_attributes_for nested_form nested-forms
---

<div dir="ltr" style="text-align: left;" trbidi="on">
<div class="tr_bq">
</div>
<br />
<span style="font-family: Verdana,sans-serif;">This is a tutorial about using nested_forms gem with dropbox-paperclip plugin on Heroku to create a multiple photo upload albums interface with twitter bootstrap&nbsp;</span><br />
<br />
<span style="font-family: Verdana,sans-serif;">Demo application :</span><br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;">&nbsp;</span><span style="font-family: Verdana,sans-serif;"><a href="http://ashish-albums.herokuapp.com/" target="_blank">http://ashish-albums.herokuapp.com/</a>&nbsp;</span></li>
</ul>
<span style="font-family: Verdana,sans-serif;">Gems used : &nbsp; </span><br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><a href="https://github.com/ryanb/nested_form" target="_blank">https://github.com/ryanb/nested_form</a></span></li>
<li><span style="font-family: Verdana,sans-serif;"><a href="https://github.com/janko-m/paperclip-dropbox" target="_blank">https://github.com/janko-m/paperclip-dropbox</a></span></li>
<li><span style="font-family: Verdana,sans-serif;"><a href="https://github.com/seyhunak/twitter-bootstrap-rails" target="_blank">https://github.com/seyhunak/twitter-bootstrap-rails</a>&nbsp;</span></li>
</ul>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<a name='more'></a><span style="font-family: Verdana,sans-serif;"><b>Step 1 : Create a new rails app and add the gems to Gemfile.&nbsp;</b></span><br />
<span style="font-family: Verdana,sans-serif;"></span>

<br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">paperclip</span></span></li>
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">
</span></span>
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">paperclip-dropbox</span></span></li>
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">
</span></span>
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #999999;"><span style="background-color: #cccccc;">nested_form&nbsp; </span></span></span></li>
</ul>
<span style="font-family: Verdana,sans-serif;"><b>Step 2 : Create 3 models</b></span><br />
<span style="font-family: Verdana,sans-serif;"></span>

<br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&nbsp;rails g model User name:string</span></span></li>
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">
</span></span>
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&nbsp;rails g model Album name:string user_id:integer</span></span></li>
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">
</span></span>
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&nbsp;rails g model Photo tags_name:string album_id:integer</span></span></li>
</ul>
<span style="font-family: Verdana,sans-serif;"><b>Step 3 : Adding relationships among models</b></span><br />
<span style="font-family: Verdana,sans-serif;"></span>

<br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;"><b><span style="background-color: #eeeeee;">in app/models/user.rb :&nbsp;</span></b> </span></span></li>
</ul>
<blockquote class="tr_bq">
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">has_many :albums, :dependent =&gt; :destroy</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">accepts_nested_attributes_for :albums</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">attr_accessible :name, :albums_attributes</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">validates_presence_of :nam</span>e </span></blockquote>
</blockquote>
<span style="font-family: Verdana,sans-serif;"></span>

<br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;"><b><span style="background-color: #eeeeee;">&nbsp;in app/models/album.rb</span></b> </span></span></li>
</ul>
<blockquote class="tr_bq">
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">belongs_to :user <br />has_many :photos, :dependent =&gt; :destroy<br />      accepts_nested_attributes_for :photos, :allow_destroy =&gt; true<br />      attr_accessible :name, :photos_attributes<br />      validates_presence_of :name</span></span></blockquote>
</blockquote>
<span style="font-family: Verdana,sans-serif;"></span>

<br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><b><span style="background-color: #eeeeee;">in app/models/photo.rb </span></b></span></li>
</ul>
<blockquote class="tr_bq">
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">belongs_to :album<br />      attr_accessible :avatar, :tags_name<br />      has_attached_file :avatar,<br />        :storage =&gt; :dropbox,<br />        :dropbox_credentials =&gt; "#{Rails.root}/config/dropbox.yml",<br />        :styles =&gt; { :thumb =&gt; "100x100" },<br />        :dropbox_options =&gt; {<br />          :path =&gt; proc { |style| "#{style}/#{id}_#{avatar.original_filename}"}<br />        }<br />      validates_presence_of :avatar </span></span></blockquote>
</blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><b>Step 4 : Adding a controller and a few actions&nbsp;</b></span><br />
<span style="font-family: Verdana,sans-serif;"></span>

<br />
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">rails g controller&nbsp; Users </span></span></li>
<li><span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;"><span style="color: red;">add following code to the controller </span></span></span><blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">def index<br />&nbsp;&nbsp;&nbsp; @users = User.all<br />end<br />&nbsp;</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">def new<br />&nbsp;&nbsp;&nbsp; @user = User.new<br />end<br />&nbsp;</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">def create<br />&nbsp;&nbsp;&nbsp; @user = User.new(params[:user])<br />&nbsp;&nbsp;&nbsp;&nbsp; if @user.save<br />&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; redirect_to root_url</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&nbsp; &nbsp; else<br />&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; redirect_to root_url<br />&nbsp;&nbsp;&nbsp; end<br />end<br />&nbsp;</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">def show_albums<br />&nbsp;&nbsp;&nbsp; @albums = Album.find(params[:id])<br />end<br />&nbsp;</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">def destroy<br />&nbsp; @user = User.find(params[:id])<br />&nbsp; @user.destroy&nbsp;</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&nbsp;&nbsp; redirect_to root_url<br />end </span></span></blockquote>
</li>
</ul>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><b>Step 5 : Adding routes to routes.rb</b></span><br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">resources :users do<br />&nbsp;&nbsp;&nbsp; member do<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; get 'show_albums'<br />&nbsp;&nbsp;&nbsp; end<br />end</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">root :to =&gt; 'users#index'</span></span></blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><b>Step 6 : Creating views for forms and data show&nbsp;</b></span><br />
<blockquote class="tr_bq">
<ul style="text-align: left;">
<li><span style="font-family: Verdana,sans-serif;">&nbsp;index.html.erb</span></li>
<li><span style="font-family: Verdana,sans-serif;">&nbsp;new.html.erb</span></li>
<li><span style="font-family: Verdana,sans-serif;">&nbsp;show_albums.html.erb</span></li>
<li><span style="font-family: Verdana,sans-serif;">&nbsp;_album_fields.html.erb</span></li>
<li><span style="font-family: Verdana,sans-serif;">&nbsp;_photo_fields.html.erb</span></li>
</ul>
</blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><b>Step 7 : Adding form html to views&nbsp;</b></span><br />
<span style="font-family: Verdana,sans-serif;">&nbsp; </span><br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="color: red;"><b>in index.html.erb :</b></span></span></blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&lt;%= link_to 'New User', new_user_path , :class =&gt; 'btn btn-medium btn-primary pull-right'%&gt;<br />&lt;table class="table table-striped"&gt;<br />&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp; &lt;th&gt;Name&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp; &lt;th&gt;Album Names&lt;/th&gt;<br />&nbsp;&nbsp;&nbsp; &lt;!--th&gt;Tags&lt;/th--&gt;<br />&nbsp;&nbsp;&nbsp; &lt;th&gt;Destroy&lt;/th&gt;<br />&nbsp; &lt;/tr&gt;<br />&lt;% @users.each do |user| %&gt;<br />&nbsp; &lt;tr&gt;<br />&nbsp;&nbsp;&nbsp; &lt;td&gt;&lt;%= user.name %&gt;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp; &lt;td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;% (user_albums_link user).each do |album_link| %&gt; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;%= album_link.html_safe %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;% end %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; &lt;% thumbnails = show_photo_thumbnails(user.albums) if user.albums %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; &lt;% if thumbnails %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;% thumbnails.each do |thumb| %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;%= thumb.html_safe&nbsp; %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;% end %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp; &lt;% end %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/td&gt;<br />&nbsp;&nbsp;&nbsp; &lt;!--td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;%#= tags user.albums %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/td--&gt;<br />&nbsp;&nbsp;&nbsp; &lt;td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;%= link_to t('.destroy', :default =&gt; t("helpers.links.destroy")),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; user_path(user),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :method =&gt; :delete,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :data =&gt; { :confirm =&gt; t('.confirm', :default =&gt; t("helpers.links.confirm", :default =&gt; 'Are you sure?')) },<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :class =&gt; 'btn btn-mini btn-danger' %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/td&gt;<br />&nbsp; &lt;/tr&gt;<br />&lt;% end %&gt;<br />&lt;/table&gt;<br />&lt;br /&gt;</span></span> </blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="color: red;"><b>in new.html.erb :</b></span></span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&lt;%= nested_form_for @user, :html =&gt; { :multipart =&gt; true } do |f| %&gt;<br />&lt;div class="controls"&gt;<br />&nbsp; Username : <br />&nbsp; &lt;%= f.text_field :name, :class =&gt; 'text_field' %&gt;<br />&lt;/div&gt;<br />&lt;%= f.fields_for :albums %&gt;<br />&lt;%= f.link_to_add "Add an album", :albums %&gt;<br />&lt;br /&gt;<br />&lt;br /&gt;<br />&lt;div class="controls"&gt;<br />&nbsp; &lt;%= f.submit nil, :class =&gt; 'btn btn-primary' %&gt;<br />&lt;/div&gt;<br />&lt;% end %&gt;</span></span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="color: red;"><b>in _album_fields.html.erb :</b></span></span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&lt;div class="controls"&gt;<br />&nbsp; Album Name : <br />&nbsp; &lt;%= f.text_field :name, :class =&gt; 'text_field' %&gt;<br />&nbsp; &lt;%= f.link_to_remove "Remove this album" %&gt;<br />&nbsp; &lt;%= f.fields_for :photos %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;p&gt;<br />&nbsp;&nbsp;&nbsp; &lt;%= f.link_to_add "Add a photo", :photos %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/p&gt;<br />&lt;/div&gt;</span></span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="color: red;"><b>in _photo_fields.html.erb</b></span> :</span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&lt;div class="controls offset1"&gt;<br />&nbsp; File : <br />&nbsp; &lt;%= f.text_field :tags_name %&gt;<br />&nbsp; &lt;%= f.file_field :avatar %&gt;<br />&nbsp; &lt;%= f.link_to_remove "Remove this photo" %&gt;<br />&lt;/div&gt;</span></span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="color: red;"><b>in show_albums.html.erb</b> :</span></span></blockquote>
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">&lt;% thumbnails = get_photos(@albums) if @albums %&gt;<br />&nbsp;&lt;% if thumbnails %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;% thumbnails.each do |thumb| %&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;%= thumb.html_safe&nbsp; %&gt;<br />&nbsp;&nbsp;&nbsp; &lt;% end %&gt;<br />&nbsp;&lt;% end %&gt;<br />&nbsp;&lt;%= show_tags @albums %&gt;</span></span> </blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><b>Step 8 :&nbsp; Add dropbox.yml in config folder with following data :</b></span><br />
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">app_key: &lt;%= ENV["DROPBOX_APP_KEY"] %&gt; <br />app_secret: &lt;%= ENV["DROPBOX_APP_SECRET"] %&gt; <br />access_token: &lt;%= ENV["DROPBOX_ACCESS_TOKEN"] %&gt; <br />access_token_secret: &lt;%= ENV["DROPBOX_ACCESS_TOKEN_SECRET"] %&gt; <br />user_id: &lt;%= ENV["DROPBOX_USER_ID"] %&gt; </span></span></blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;">These variables are Environment variables in environments files.</span><br />
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;">For detailed setup for paperclip-dropbox gem visit</span><br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><a href="https://github.com/janko-m/paperclip-dropbox" target="_blank">https://github.com/janko-m/paperclip-dropbox</a>&nbsp;</span></blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><b>Step 9 : Setup Twitter Bootstrap </b><span style="background-color: #cccccc;">&nbsp;</span></span><br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">rails generate bootstrap:install less</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">rails g bootstrap:layout application fixed</span></span></blockquote>
<span style="font-family: Verdana,sans-serif;"><b>Step 10 : Run the application :</b></span><br />
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">bundle&nbsp;</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">rake db:create</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">rake db:migrate</span></span><br />
<span style="font-family: Verdana,sans-serif;"><span style="background-color: #cccccc;">rails s</span></span></blockquote>
<br />
-----------------------------------------------------------------------------------------------------------------------Thanks <br />
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<blockquote class="tr_bq ">
</blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<blockquote class="tr_bq">
<blockquote class="tr_bq">
<span style="font-family: Verdana,sans-serif;"><br />&nbsp;</span></blockquote>
</blockquote>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<span style="font-family: Verdana,sans-serif;"><br /></span>
<br />
<span style="font-family: Verdana,sans-serif;"><br /></span></div>
<img src="http://feeds.feedburner.com/~r/blogspot/GMijy/~4/dNjRnKm5HUg" height="1" width="1"/>