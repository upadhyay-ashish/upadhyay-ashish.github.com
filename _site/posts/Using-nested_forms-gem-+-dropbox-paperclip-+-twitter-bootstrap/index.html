<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      Using nested_forms gem + dropbox-paperclip + twitter-bootstrap &ndash;
    
    Ashish Upadhyay
  </title>

  <meta name="author" content="Ashish Upadhyay" />
  <meta name="description" content="A fantastic blog that is fantastic." />

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/iphone.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/iphone.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link href='http://fonts.googleapis.com/css?family=PT+Sans&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css' />


  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>

</head>

<body>
  <section class="sidebar">
    <a href="/">
      <img src="https://secure.gravatar.com/avatar/a9bdddc86fb5585eaf2ebbb8e262735e?s=420?s=150" height="145" width="135" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Ashish</span>
        <span id="lname">Upadhyay</span>
      </a>
    </section>

    <section class="meta">
      <a href="https://github.com/upadhyay-ashish" target="_blank"><img src="/images/github.png" /></a>
      <a href="https://twitter.com/_zapper320" target="_blank"><img src="/images/twitter.png"></a>
      <a href="/atom.xml"><img src="/images/rss.png" /></a>

    </section>

    <section class="sections">

      <ul>
        <li><a href="/about.html">about</a></li>
        <li><a href="/">posts</a></li>

      </ul>
    </section>


</section>

  <section class="content">
  <h1>
    <a href="/posts/Using-nested_forms-gem-%2B-dropbox-paperclip-%2B-twitter-bootstrap">Using nested_forms gem + dropbox-paperclip + twitter-bootstrap</a>
     
 <style type="text/css">#counter_179438 {font-family: "Verdana"; font-size: 11px; clear: left; color: #BBBBBB;}  #counter_179438 a {color: #BBBBBB;}#counter_div_179438 {height: 15px}</style><div id="counter_div_179438"></div><p id="counter_179438"><span></span> <a target="_blank" href="http://www.free-website-hit-counters.com/">hit counter</a> <span></span></p><script type="text/javascript" src="http://free-website-hit-counters.com/black-verdana/179438"></script>
  <ul class="listing">
  </h1>

  <section class="byline">
    December  8, 2012
  </section>

  <h4>This is a tutorial about using nested_forms gem with dropbox-paperclip plugin on Heroku to create a multiple photo upload albums interface with twitter bootstrap</h4>

<p><a href="http://ashish-albums.herokuapp.com">Demo application</a></p>

<ul>
<li>Create a new rails app and add the gems to Gemfile.**</li>
</ul>


<div class="highlight"><pre><code class="ruby">        <span class="n">paperclip</span>
        <span class="n">paperclip</span><span class="o">-</span><span class="n">dropbox</span>
        <span class="n">nested_form</span>     
      
</code></pre></div>


<ul>
<li>Create 3 models**</li>
</ul>


<div class="highlight"><pre><code class="ruby">        <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">User</span> <span class="nb">name</span><span class="ss">:string</span>  
        <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Album</span> <span class="nb">name</span><span class="ss">:string</span> <span class="n">user_id</span><span class="ss">:integer</span>
        <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Photo</span> <span class="n">tags_name</span><span class="ss">:string</span> <span class="n">album_id</span><span class="ss">:integer</span>    
   
</code></pre></div>


<ul>
<li>Adding relationships among models

<h4>in app/models/user.rb</h4></li>
</ul>


<div class="highlight"><pre><code class="ruby">        <span class="n">has_many</span> <span class="ss">:albums</span><span class="p">,</span> <span class="ss">:dependent</span> <span class="o">=</span><span class="ss">:destroy</span>  
        <span class="n">accepts_nested_attributes_for</span> <span class="ss">:albums</span>  
        <span class="n">attr_accessible</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:albums_attributes</span>  
        <span class="n">validates_presence_of</span> <span class="ss">:name</span>    
        <span class="n">belongs_to</span> <span class="ss">:user</span>   
        <span class="n">has_many</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">:dependent</span> <span class="o">=</span><span class="ss">:destroy</span>  
        <span class="n">accepts_nested_attributes_for</span> <span class="ss">:photos</span><span class="p">,</span> <span class="ss">:allow_destroy</span> <span class="o">=</span><span class="kp">true</span>  
        <span class="n">attr_accessible</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:photos_attributes</span>  
        <span class="n">validates_presence_of</span> <span class="ss">:name</span>   
        <span class="n">belongs_to</span> <span class="ss">:album</span>  
        <span class="n">attr_accessible</span> <span class="ss">:avatar</span><span class="p">,</span> <span class="ss">:tags_name</span>  
        <span class="n">has_attached_file</span> <span class="ss">:avatar</span><span class="p">,</span>  
        <span class="ss">:storage</span> <span class="o">=</span><span class="ss">:dropbox</span><span class="p">,</span>  
        <span class="ss">:dropbox_credentials</span> <span class="o">=</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/config/dropbox.yml&quot;</span><span class="p">,</span>  
        <span class="ss">:styles</span> <span class="o">=</span><span class="p">{</span> <span class="ss">:thumb</span> <span class="o">=</span><span class="s2">&quot;100x100&quot;</span> <span class="p">},</span>  
        <span class="ss">:dropbox_options</span> <span class="o">=</span><span class="p">{</span>  
        <span class="ss">:path</span> <span class="o">=</span><span class="nb">proc</span> <span class="p">{</span> <span class="o">|</span><span class="n">style</span><span class="o">|</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">style</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">avatar</span><span class="o">.</span><span class="n">original_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>  
        <span class="p">}</span>  
        <span class="n">validates_presence_of</span> <span class="ss">:avatar</span>   
</code></pre></div>


<ul>
<li>Adding a controller and a few actions**</li>
</ul>


<div class="highlight"><pre><code class="ruby">   
    <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="no">Users</span> 
        <span class="n">add</span> <span class="n">following</span> <span class="n">code</span> <span class="n">to</span> <span class="n">the</span> <span class="n">controller</span> 
        <span class="k">def</span> <span class="nf">index</span>  
         <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>  
        <span class="k">end</span>  
          
        <span class="k">def</span> <span class="nf">new</span>  
         <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>  
        <span class="k">end</span>  
          
        <span class="k">def</span> <span class="nf">create</span>  
         <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span><span class="p">)</span>  
         <span class="k">if</span> <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>  
          <span class="n">redirect_to</span> <span class="n">root_url</span>  
          <span class="k">else</span>  
           <span class="n">redirect_to</span> <span class="n">root_url</span>  
         <span class="k">end</span>  
        <span class="k">end</span>  
          
        <span class="k">def</span> <span class="nf">show_albums</span>  
         <span class="vi">@albums</span> <span class="o">=</span> <span class="no">Album</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>  
        <span class="k">end</span>  
          
        <span class="k">def</span> <span class="nf">destroy</span>  
         <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>  
         <span class="vi">@user</span><span class="o">.</span><span class="n">destroy</span>  
         <span class="n">redirect_to</span> <span class="n">root_url</span>  
        <span class="k">end</span> 
      
</code></pre></div>


<ul>
<li>Adding routes to routes.rb</li>
</ul>


<div class="highlight"><pre><code class="ruby">   
        <span class="n">resources</span> <span class="ss">:users</span> <span class="k">do</span>  
         <span class="n">member</span> <span class="k">do</span>  
         <span class="n">get</span> <span class="s1">&#39;show_albums&#39;</span>  
         <span class="k">end</span>  
        <span class="k">end</span>  
        <span class="n">root</span> <span class="ss">:to</span> <span class="o">=</span><span class="s1">&#39;users#index&#39;</span>  
</code></pre></div>


<ul>
<li>Creating views for forms and data show</li>
</ul>


<div class="highlight"><pre><code class="ruby">   
        <span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
        <span class="kp">new</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
        <span class="n">show_albums</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
        <span class="n">_album_fields</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
        <span class="n">_photo_fields</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span>
</code></pre></div>


<ul>
<li>Adding form html to views**

<h4>in index.html.erb :**</h4></li>
</ul>


<div class="highlight"><pre><code class="ruby">   
        <span class="o">&lt;</span><span class="sx">%= link_to &#39;New User&#39;, new_user_path , :class =</span><span class="o">&gt;</span> <span class="s1">&#39;btn btn-medium btn-primary pull-right&#39;</span><span class="sx">%&gt;</span>
<span class="sx">        &lt;table class=&quot;table table-striped&quot;&gt;</span>
        <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="no">Name</span><span class="o">&lt;</span><span class="sr">/th&gt;</span>
<span class="sr">        &lt;th&gt;Album Names&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
        <span class="o">&lt;!--</span><span class="n">th</span><span class="o">&gt;</span><span class="no">Tags</span><span class="o">&lt;</span><span class="sr">/th--&gt;</span>
<span class="sr">        &lt;th&gt;Destroy&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="sr">/tr&gt;</span>
<span class="sr">        &lt;% @users.each do |user| %&gt;</span>
<span class="sr">        &lt;tr&gt;</span>
<span class="sr">        &lt;td&gt;&lt;%= user.name %&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="sx">% (user_albums_link </span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">album_link</span><span class="o">|</span> <span class="sx">%&gt;</span>
<span class="sx">            &lt;%= album_link.html_safe %&gt;</span>
          <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">         &lt;% thumbnails = show_photo_thumbnails(user.albums) if user.albums %&gt;</span>
         <span class="o">&lt;</span><span class="sx">% if </span><span class="n">thumbnails</span> <span class="sx">%&gt;</span>
<span class="sx">            &lt;% thumbnails.each do |thumb| %&gt;</span>
              <span class="o">&lt;</span><span class="sx">%= thumb.html_safe  %&gt;</span>
<span class="sx">            &lt;% end %&gt;</span>
<span class="sx">         &lt;% end %&gt;</span>
<span class="sx">        &lt;/td&gt;</span>
<span class="sx">        &lt;!--td&gt;</span>
<span class="sx">          &lt;%#=</span> <span class="n">tags</span> <span class="n">user</span><span class="o">.</span><span class="n">albums</span> <span class="sx">%&gt;</span>
<span class="sx">        &lt;/td--&gt;</span>
        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="sx">%= link_to t(&#39;.destroy&#39;, :default =</span><span class="o">&gt;</span> <span class="n">t</span><span class="p">(</span><span class="s2">&quot;helpers.links.destroy&quot;</span><span class="p">)),</span>
              <span class="n">user_path</span><span class="p">(</span><span class="n">user</span><span class="p">),</span>
              <span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span><span class="p">,</span>
              <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="n">t</span><span class="p">(</span><span class="s1">&#39;.confirm&#39;</span><span class="p">,</span> 
              <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="n">t</span><span class="p">(</span><span class="s2">&quot;helpers.links.confirm&quot;</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s1">&#39;Are you sure?&#39;</span><span class="p">))</span> <span class="p">},</span>
              <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s1">&#39;btn btn-mini btn-danger&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">        &lt;/td&gt;</span>
        <span class="o">&lt;</span><span class="sr">/tr&gt;</span>
<span class="sr">        &lt;% end %&gt;</span>
<span class="sr">        &lt;/</span><span class="n">table</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">br</span> <span class="sr">/&gt;</span>
<span class="sr">  </span>
</code></pre></div>


<ul>
<li>in new.html.erb</li>
</ul>


<div class="highlight"><pre><code class="ruby">     
        <span class="o">&lt;</span><span class="sx">%= nested_form_for @user, :html =</span><span class="o">&gt;</span> <span class="p">{</span> <span class="ss">:multipart</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="sx">%&gt;</span>
<span class="sx">        &lt;div class=&quot;controls&quot;&gt;</span>
          <span class="no">Username</span> <span class="p">:</span>
          <span class="o">&lt;</span><span class="sx">%= f.text_field :name, :class =</span><span class="o">&gt;</span> <span class="s1">&#39;text_field&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">        &lt;/div&gt;</span>
        <span class="o">&lt;</span><span class="sx">%= f.fields_for :albums %&gt;</span>
<span class="sx">        &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">link_to_add</span> <span class="s2">&quot;Add an album&quot;</span><span class="p">,</span> <span class="ss">:albums</span> <span class="sx">%&gt;</span>
<span class="sx">        &lt;br /&gt;</span>
        <span class="o">&lt;</span><span class="n">br</span> <span class="sr">/&gt;</span>
<span class="sr">        &lt;div class=&quot;controls&quot;&gt;</span>
<span class="sr">          &lt;%= f.submit nil, :class =&gt; &#39;btn btn-primary&#39; %&gt;</span>
<span class="sr">        &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</code></pre></div>


<ul>
<li>in _album_fields.html.erb</li>
</ul>


<div class="highlight"><pre><code class="ruby">     
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;controls&quot;</span><span class="o">&gt;</span>
          <span class="no">Album</span> <span class="no">Name</span> <span class="p">:</span>
          <span class="o">&lt;</span><span class="sx">%= f.text_field :name, :class =</span><span class="o">&gt;</span> <span class="s1">&#39;text_field&#39;</span> <span class="sx">%&gt;</span>
<span class="sx">          &lt;%= f.link_to_remove &quot;Remove this album&quot; %&gt;</span>
          <span class="o">&lt;</span><span class="sx">%= f.fields_for :photos %&gt;</span>
<span class="sx">            &lt;p&gt;</span>
<span class="sx">            &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">link_to_add</span> <span class="s2">&quot;Add a photo&quot;</span><span class="p">,</span> <span class="ss">:photos</span> <span class="sx">%&gt;</span>
<span class="sx">            &lt;/p&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</code></pre></div>


<ul>
<li>in _photo_fields.html.erb</li>
</ul>


<div class="highlight"><pre><code class="ruby">     
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;controls offset1&quot;</span><span class="o">&gt;</span>
          <span class="no">File</span> <span class="p">:</span>
          <span class="o">&lt;</span><span class="sx">%= f.text_field :tags_name %&gt;</span>
<span class="sx">          &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_field</span> <span class="ss">:avatar</span> <span class="sx">%&gt;</span>
<span class="sx">          &lt;%= f.link_to_remove &quot;Remove this photo&quot; %&gt;</span>
        <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</code></pre></div>


<ul>
<li>in show_albums.html.erb</li>
</ul>


<div class="highlight"><pre><code class="ruby">        <span class="o">&lt;</span><span class="sx">% thumbnails </span><span class="o">=</span> <span class="n">get_photos</span><span class="p">(</span><span class="vi">@albums</span><span class="p">)</span> <span class="k">if</span> <span class="vi">@albums</span> <span class="sx">%&gt;</span>
<span class="sx">         &lt;% if thumbnails %&gt;</span>
            <span class="o">&lt;</span><span class="sx">% thumbnails.each </span><span class="k">do</span> <span class="o">|</span><span class="n">thumb</span><span class="o">|</span> <span class="sx">%&gt;</span>
<span class="sx">              &lt;%= thumb.html_safe  %&gt;</span>
            <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
<span class="sx">         &lt;% end %&gt;</span>
         <span class="o">&lt;%=</span> <span class="n">show_tags</span> <span class="vi">@albums</span> <span class="o">%&gt;</span>
          
</code></pre></div>


<ul>
<li>Add dropbox.yml in config folder with following data :**</li>
</ul>


<div class="highlight"><pre><code class="ruby">        <span class="n">app_key</span><span class="p">:</span>    
        <span class="n">app_secret</span><span class="p">:</span>    
        <span class="n">access_token</span><span class="p">:</span>    
        <span class="n">access_token_secret</span><span class="p">:</span>    
        <span class="n">user_id</span><span class="p">:</span>
    
</code></pre></div>


<ul>
<li><p>These variables are Environment variables in environments files.</p></li>
<li><p>For detailed setup for paperclip-dropbox gem <a href="https://github.com/janko-m/paperclip-dropbox">paperclip-dropbox</a></p></li>
<li>Setup Twitter Bootstrap **</li>
</ul>


<div class="highlight"><pre><code class="ruby">        <span class="n">rails</span> <span class="n">generate</span> <span class="ss">bootstrap</span><span class="p">:</span><span class="n">install</span> <span class="n">less</span>  
        <span class="n">rails</span> <span class="n">g</span> <span class="ss">bootstrap</span><span class="p">:</span><span class="n">layout</span> <span class="n">application</span> <span class="n">fixed</span><span class="o">**</span><span class="no">Step</span> <span class="mi">10</span> <span class="p">:</span> <span class="no">Run</span> <span class="n">the</span> <span class="n">application</span> <span class="ss">:**</span>  
        <span class="n">bundle</span>  
        <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">create</span>  
        <span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>  
        <span class="n">rails</span> <span class="n">s</span>     
</code></pre></div>





  <!-- TODO: bio here -->
  <section class="meta" style="border:0px">
    <h3>Discussion, links, and tweets</h3>
    <section class="copy">
      <a href="https://twitter.com/_zapper320" target="_blank">
        <img src="https://secure.gravatar.com/avatar/a9bdddc86fb5585eaf2ebbb8e262735e?s=420?s=142" height="50" width="50" />
      </a>

      <p>
        I'm a developer at TCS. <a href="https://twitter.com/_zapper320" target="_blank">Follow me on Twitter</a>;
        you'll enjoy my tweets. I take care to carefully craft each one. Or at least aim to make
        you giggle. Or offended. One of those two&mdash; I haven't decided which yet.
      </p>

      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="_zapper320">Tweet</a>
      <a href="http://twitter.com/_zapper320" class="twitter-follow-button" data-show-count="false">Follow @_zapper320</a>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>
  </section>
</section>

<

  </div>
</section>

</body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39566611-1', 'ashish-upadhyay.com');
  ga('send', 'pageview');

</script>
</html>
