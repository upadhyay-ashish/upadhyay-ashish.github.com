---           
layout: post
title: MetaWhere Getting Started
date: 2011-09-29 05:43:30 UTC
updated: 2011-09-29 05:43:30 UTC
comments: false
categories: ruby ruby on rails search rails search metawhere
---

<div dir="ltr" style="text-align: left;" trbidi="on"><span class="Apple-style-span" style="background-color: #f8f8f8; font-family: helvetica, arial, freesans, clean, sans-serif; font-size: 13px;"></span><br />
<div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">In your Gemfile:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">gem "meta_where"  # Last officially released gem
# gem "meta_where", :git =&gt; "git://github.com/ernie/meta_where.git" # Track git repo</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">or, to install as a plugin:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">rails plugin install git://github.com/ernie/meta_where.git</pre><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Example usage</h2><h3 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-width: 0px !important; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Where</h3><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">You can use MetaWhere in your usual method chain:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(:title.matches =&gt; 'Hello%', :created_at.gt =&gt; 3.days.ago)
=&gt; SELECT "articles".* FROM "articles" WHERE ("articles"."title" LIKE 'Hello%')
   AND ("articles"."created_at" &gt; '2010-04-12 18:39:32.592087')</pre><h3 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-width: 0px !important; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Find condition hash</h3><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">You can also use similar syntax in a conditions hash supplied to ActiveRecord::Base#find:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.find(:all,
  :conditions =&gt; {
    :title.matches =&gt; 'Hello%',
    :created_at.gt =&gt; 3.days.ago
  }
)</pre><h3 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-width: 0px !important; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Scopes</h3><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">They also work in named scopes as you would expect.</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">class Article
  scope :recent, lambda {|v| where(:created_at.gt =&gt; v.days.ago)}
end

Article.recent(14).to_sql
=&gt; SELECT "articles".* FROM "articles"
   WHERE ("articles"."created_at" &gt; '2010-04-01 18:54:37.030951')</pre><h3 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-width: 0px !important; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Operators (Optionally)</h3><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Additionally, you can use certain operators as shorthand for certain Arel predication methods.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">These are disabled by default, but can be enabled by calling MetaWhere.operator_overload! during your app’s initialization process.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">These are experimental at this point and subject to change. Keep in mind that if you don’t want to enclose other conditions in {}, you should place operator conditions before any hash conditions.</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(:created_at &gt; 100.days.ago, :title =~ 'Hi%').to_sql
=&gt; SELECT "articles".* FROM "articles"
   WHERE ("articles"."created_at" &gt; '2010-01-05 20:11:44.997446')
   AND ("articles"."title" LIKE 'Hi%')</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Operators are:</div><ul style="margin-bottom: 1em !important; margin-left: 2em !important; margin-right: 0px !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">&gt;&gt; (equal)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">^ (not equal)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">+ (in array/range)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><ul style="margin-bottom: 0px !important; margin-left: 2em !important; margin-right: 0px !important; margin-top: 0px !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">(not in array/range)</div></li>
</ul></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">!~ (not matching, only available under Ruby 1.9)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">&gt; (greater than)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">&gt;= (greater than or equal to)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">&lt; (less than)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">&lt;= (less than or equal to)</div></li>
<li style="margin-bottom: 0.5em; margin-left: 0px; margin-right: 0px; margin-top: 0.5em; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><br />
<dl style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><dt style="font-weight: bold !important; margin-bottom: 0px; margin-left: 1em !important; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"></dt>
<dd style="margin-bottom: 1em !important; margin-left: 2em !important; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">(SQL functions – more on those below)</div></dd></dl></li><br />
</ul><h3 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-width: 0px !important; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Compounds</h3><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">You can use the &amp; and | operators to perform ands and ors within your queries.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><b style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With operators:</b></div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where((:title =~ 'Hello%') | (:title =~ 'Goodbye%')).to_sql
=&gt; SELECT "articles".* FROM "articles" WHERE (("articles"."title" LIKE 'Hello%'
   OR "articles"."title" LIKE 'Goodbye%'))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">That’s kind of annoying, since operator precedence is such that you have to put parentheses around everything. So MetaWhere also supports a substitution-inspired (String#%) syntax.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><b style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With “substitutions”:</b></div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(:title.matches % 'Hello%' | :title.matches % 'Goodbye%').to_sql
=&gt; SELECT "articles".* FROM "articles" WHERE (("articles"."title" LIKE 'Hello%'
   OR "articles"."title" LIKE 'Goodbye%'))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><b style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With hashes:</b></div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(
  {:created_at.lt =&gt; Time.now} &amp; {:created_at.gt =&gt; 1.year.ago}
).to_sql
=&gt; SELECT "articles".* FROM "articles" WHERE
   ((("articles"."created_at" &lt; '2010-04-16 00:26:30.629467')
   AND ("articles"."created_at" &gt; '2009-04-16 00:26:30.629526')))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><b style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With both hashes and substitutions:</b></div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(
  :title.matches % 'Hello%' &amp;
  {:created_at.lt =&gt; Time.now, :created_at.gt =&gt; 1.year.ago}
).to_sql
=&gt; SELECT "articles".* FROM  "articles" WHERE (("articles"."title" LIKE 'Hello%' AND
   ("articles"."created_at" &lt; '2010-04-16 01:04:38.023615' AND
    "articles"."created_at" &gt; '2009-04-16 01:04:38.023720')))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><b style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With insanity… errr, complex combinations(*):</b></div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.joins(:comments).where(
  {:title =&gt; 'Greetings'} |
  (
    (
      :created_at.gt % 21.days.ago &amp;
      :created_at.lt % 7.days.ago
    ) &amp;
    :body.matches % '%from the past%'
  ) &amp;
  {:comments =&gt; [:body =~ '%first post!%']}
).to_sql
=&gt; SELECT "articles".*
   FROM "articles"
     INNER JOIN "comments"
     ON "comments"."article_id" = "articles"."id"
   WHERE
   ((
     "articles"."title" = 'Greetings'
     OR
     (
       (
         (
           "articles"."created_at" &gt; '2010-03-26 05:57:57.924258'
           AND "articles"."created_at" &lt; '2010-04-09 05:57:57.924984'
         )
         AND "articles"."body" LIKE '%from the past%'
       )
       AND "comments"."body" LIKE '%first post!%'
     )
   ))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">(*) Formatting added for clarity. I said you could do this, not that you should. :)</div><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Join type specification</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">You can choose whether to use an inner join (the default) or a left outer join by tacking&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">.outer</tt>&nbsp;or&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">.inner</tt>&nbsp;to the symbols specified in your joins() call:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.joins(:comments =&gt; :moderations.outer).to_sql
=&gt; SELECT "articles".* FROM "articles"
   INNER JOIN "comments" ON "comments"."article_id" = "articles"."id"
   LEFT OUTER JOIN "moderations" ON "moderations"."comment_id" = "comments"."id"</pre><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">SQL Functions</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">You can use SQL functions in your queries:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Manager.joins(:employees.outer).group('managers.id').
        having(:employees =&gt; (:count.func(:id) &lt; 3))
=&gt; SELECT "managers".* FROM "managers"
   LEFT OUTER JOIN "employees" ON "employees"."manager_id" = "managers"."id"
   GROUP BY managers.id HAVING count("employees"."id") &lt; 3</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">If you enable Symbol operators, you can just use&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">:count[:id]</tt>, instead of calling&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">func</tt>&nbsp;as shown above. SQL functions work in the SELECT, WHERE, and HAVING clauses, and can be aliased with&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">as</tt>:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Manager.select('managers.*').
        select(:find_in_set[:id, '3,2,1'].as('position'))
=&gt; SELECT managers.*, find_in_set("managers"."id",'3,2,1') AS position
   FROM "managers"</pre><h3 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-width: 0px !important; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">But wait, there’s more!</h3><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Intelligent hash condition mapping</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">This is one of those things I hope you find so intuitive that you forget it wasn’t built in already.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">PredicateBuilder (the part of ActiveRecord responsible for turning your conditions hash into a valid SQL query) will allow you to nest conditions in order to specify a table that the conditions apply to:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.joins(:comments).where(:comments =&gt; {:body =&gt; 'hey'}).to_sql
=&gt; SELECT "articles".* FROM "articles" INNER JOIN "comments"
   ON "comments"."article_id" = "articles"."id"
   WHERE ("comments"."body" = 'hey')</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">This feels pretty magical at first, but the magic quickly breaks down. Consider an association named&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">:other_comments</tt>&nbsp;that is just a condition against comments:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.joins(:other_comments).where(:other_comments =&gt; {:body =&gt; 'hey'}).to_sql
=&gt; ActiveRecord::StatementInvalid: No attribute named `body` exists for table `other_comments`</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Ick. This is because the query is being created against tables, and not against associations. You’d need to do…</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.joins(:other_comments).where(:comments =&gt; {:body =&gt; 'hey'})</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">…instead.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With MetaWhere:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.joins(:other_comments).where(:other_comments =&gt; {:body =&gt; 'hey'}).to_sql
=&gt; SELECT "articles".* FROM "articles" INNER JOIN "comments"
   ON "comments"."article_id" = "articles"."id" WHERE (("comments"."body" = 'hey'))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">The general idea is that if an association with the name provided exists, MetaWhere will build the conditions against that association’s table as it’s been aliased, before falling back to assuming you’re specifying a table by name. It also handles nested associations:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(
  :comments =&gt; {
    :body =&gt; 'yo',
    :moderations =&gt; [:value &lt; 0]
  },
  :other_comments =&gt; {:body =&gt; 'hey'}
).joins(
  {:comments =&gt; :moderations},
  :other_comments
).to_sql
=&gt; SELECT "articles".* FROM "articles"
   INNER JOIN "comments" ON "comments"."article_id" = "articles"."id"
   INNER JOIN "moderations" ON "moderations"."comment_id" = "comments"."id"
   INNER JOIN "comments" "other_comments_articles"
     ON "other_comments_articles"."article_id" = "articles"."id"
  WHERE (("comments"."body" = 'yo' AND "moderations"."value" &lt; 0
    AND "other_comments_articles"."body" = 'hey'))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Contrived example, I’ll admit – but I’ll bet you can think of some uses for this.</div><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Enhanced relation merges</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">One of the changes MetaWhere makes to ActiveRecord is to delay “compiling” the where_values into actual Arel predicates until absolutely necessary. This allows for greater flexibility and last-second inference of associations/joins from any hashes supplied. A drawback of this method is that when merging relations, ActiveRecord just assumes that the values being merged are already firmed up against a specific table name and can just be thrown together. This isn’t the case with MetaWhere, and would cause unexpected failures when merging. However, MetaWhere improves on the default ActiveRecord merge functionality in two ways. First, when called with 1 parameter, (as is always the case when using the &amp; alias) MetaWhere will try to determine if an association exists between the two models involved in the merge. If it does, the association name will be used to construct criteria.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Additionally, to cover times when detection is impossible, or the first detected association isn’t the one you wanted, you can call merge with a second parameter, specifying the association to be used during the merge.</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">This merge functionality allows you to do this…</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">(Comment.where(:id &lt; 7) &amp; Article.where(:title =~ '%blah%')).to_sql
=&gt; SELECT "comments".* FROM "comments" INNER JOIN "articles"
   ON "articles"."id" = "comments"."article_id"
   WHERE ("comments"."id" &lt; 7) AND ("articles"."title" LIKE '%blah%')"</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">…or this…</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.where(:id &lt; 2).merge(Comment.where(:id &lt; 7), :lame_comments).to_sql
=&gt; "SELECT "articles".* FROM "articles"
   INNER JOIN "comments" ON "comments"."article_id" = "articles"."id"
      AND "comments"."body" = 'first post!'
   WHERE ("articles"."id" &lt; 2) AND ("comments"."id" &lt; 7)"</pre><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Enhanced order clauses</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">If you are used to doing stuff like&nbsp;<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Article.order('title asc')</tt>, that will still work as you expect. However, if you pass symbols or arrays in to the<tt style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">order</tt>&nbsp;method, you can take advantage of intelligent association detection (as with “Intelligent hash condition mapping,” above) and also some convenience methods for ascending and descending sorts.</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Article.order(
  :title.desc,
  :comments =&gt; [:created_at.asc, :updated_at]
).joins(:comments).to_sql
=&gt; SELECT "articles".* FROM "articles"
   INNER JOIN "comments" ON "comments"."article_id" = "articles"."id"
   ORDER BY  "articles"."title" DESC,
     "comments"."created_at" ASC, "comments"."updated_at"</pre><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Polymorphic belongs_to joins</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Polymorphic associations provide great flexibility, but they can sometimes be a bit of a hassle when it comes to querying through a belongs_to association. First, you have to know what type you’re looking for to do a proper join, and then, you’re forced into using a string join in order to make it happen (which would prevent the use of MetaWhere intelligent condition mapping).</div><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">MetaWhere allows you to join polymorphic belongs_to associations like this:</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;">Note.joins(:notable.type(Developer)).
     where(:notable.type(Developer) =&gt; {:name.matches =&gt; 'Ernie%'})
=&gt; SELECT "notes".* FROM "notes"
   INNER JOIN "developers" ON "developers"."id" = "notes"."notable_id"
     AND "notes"."notable_type" = 'Developer'
   WHERE "developers"."name" LIKE 'Ernie%'</pre><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Using ActiveRecord objects as condition values</h2><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">Wouldn’t it be nice if you could do something like this?</div><pre style="-webkit-box-shadow: rgba(0, 0, 0, 0.0664063) 0px 1px 2px inset; background-color: #eeeeee; border-bottom-color: rgb(221, 221, 221); border-bottom-left-radius: 3px 3px; border-bottom-right-radius: 3px 3px; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(221, 221, 221); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(221, 221, 221); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(221, 221, 221); border-top-left-radius: 3px 3px; border-top-right-radius: 3px 3px; border-top-style: solid; border-top-width: 1px; color: #444444; font-size: 12px; font: normal normal normal 12px/normal 'Bitstream Vera Sans Mono', Courier, monospace; margin-bottom: 1em; margin-top: 1em; overflow-x: auto; overflow-y: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px;"># Developer belongs_to Company
company = Company.find(123)
Developer.where(:company =&gt; company)

# Developer HABTM Projects
projects = [Project.first, Project.last]
Developer.joins(:projects).where(:projects =&gt; projects)

# Note belongs_to :notable, :polymorphic =&gt; true
dev1 = Developer.first
dev2 = Developer.last
project = Project.first
company = Company.first
Note.where(:notable =&gt; [dev1, dev2, project, company]).to_sql
=&gt; SELECT "notes".* FROM "notes" WHERE (((("notes"."notable_id" IN (1, 8)
   AND "notes"."notable_type" = 'Developer') OR ("notes"."notable_id" = 1
   AND "notes"."notable_type" = 'Project')) OR ("notes"."notable_id" = 1
   AND "notes"."notable_type" = 'Company')))</pre><div style="line-height: 1.5em !important; margin-bottom: 1em !important; margin-top: 1em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">With MetaWhere, you can.</div><h2 style="border-bottom-width: 0px !important; border-color: initial !important; border-left-width: 0px !important; border-right-width: 0px !important; border-style: initial !important; border-top-color: rgb(224, 224, 224) !important; border-top-style: solid !important; border-top-width: 4px !important; font-size: 20px; margin-bottom: 1em; margin-left: 0px; margin-right: 0px; margin-top: 1.5em !important; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0.5em !important;">Thanks</h2></div><img src="http://feeds.feedburner.com/~r/blogspot/GMijy/~4/QVx6Fd615UY" height="1" width="1"/>